/*!
 * jmpress.js v0.3.0
 * http://shama.github.com/jmpress.js
 *
 * A jQuery plugin to build a website on the infinite canvas.
 *
 * Copyright 2012 Kyle Robinson Young @shama & Tobias Koppers @sokra
 * Licensed MIT
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Based on the foundation laid by Bartek Szopka @bartaz
 */
(function(a,b,c,d){function f(a){var b=1+a.substr(1).search(/[A-Z]/),c=a.substr(0,b).toLowerCase(),d=a.substr(b).toLowerCase();return"-"+c+"-"+d}function i(e){function u(b,c){var d=m(b),e={oldStyle:a(b).attr("style")||""},f={data:d,stepData:e};y.call(this,"beforeInitStep",a(b),f),e.delegate=d.delegate,y.call(this,"initStep",a(b),f),a(b).data("stepData",e),a(b).attr("id")||a(b).attr("id","step-"+(c+1)),y.call(this,"applyStep",a(b),f)}function v(b){var c=a(b).data("stepData");a(b).attr("style",c.oldStyle),y.call(this,"unapplyStep",a(b),{stepData:c})}function w(b){y.call(this,"unapplyStep",a(b),{stepData:b.data("stepData")}),y.call(this,"applyStep",a(b),{stepData:b.data("stepData")})}function x(){s&&y.call(this,"setInactive",s,{stepData:a(s).data("stepData"),reason:"deinit"}),r.jmpressClass&&a(k).removeClass(r.jmpressClass),y.call(this,"beforeDeinit",a(this),{}),a(j.stepSelector,k).each(function(a){v.call(k,this)}),n.attr("style",p.container),o.attr("style",p.area),a(q).children().each(function(){k.append(a(this))}),j.fullscreen?q.remove():(q.remove(),o.remove()),y.call(this,"afterDeinit",a(this),{}),a(k).data("jmpressmethods",d)}function y(b,c,d){d.settings=j,d.current=r,d.container=n,d.parents=c?A(c):null,d.current=r,d.jmpress=this;var e={};return a.each(j[b],function(a,b){e.value=b.call(k,c,d)||e.value}),e.value}function z(){if(!s)return;var b=a(s).near(j.stepSelector).add(a(s).near(j.stepSelector,!0)).add(y.call(this,"selectPrev",s,{stepData:a(s).data("stepData")})).add(y.call(this,"selectNext",s,{stepData:a(s).data("stepData")}));b.each(function(){var b=this;if(a(b).hasClass(j.loadedClass))return;setTimeout(function(){if(a(b).hasClass(j.loadedClass))return;y.call(k,"loadStep",b,{stepData:a(b).data("stepData")}),a(b).addClass(j.loadedClass)},j.transitionDuration-100)});if(a(s).hasClass(j.loadedClass))return;y.call(k,"loadStep",s,{stepData:a(s).data("stepData")}),a(s).addClass(j.loadedClass)}function A(b){var c=[],d=b;while(a(d).parent().length&&a(d).parent().is(j.stepSelector))d=a(d).parent(),c.push(d[0]);return c}function B(b,c){typeof b=="string"&&(b=k.find(b).first());if(!b||!a(b).data("stepData"))return!1;C.call(this);var e=a(b).data("stepData"),f=!1;y.call(this,"beforeChange",b,{stepData:e,reason:c,cancel:function(){f=!0}});if(f)return d;var g={},h=b;a(b).data("stepData").delegate&&(h=a(b).parentsUntil(k).filter(j.stepSelector).filter(e.delegate)||a(b).near(e.delegate)||a(b).near(e.delegate,!0)||a(e.delegate,k),e=h.data("stepData")),t&&y.call(this,"setInactive",t,{stepData:a(t).data("stepData"),delegatedFrom:s,reason:c,target:g,nextStep:h,nextStepData:e});var i={stepData:e,delegatedFrom:b,reason:c,target:g,prevStep:t,prevStepData:t&&a(t).data("stepData")};return y.call(this,"beforeActive",h,i),y.call(this,"setActive",h,i),r.jmpressClass&&a(k).removeClass(r.jmpressClass),a(k).addClass(r.jmpressClass="step-"+a(h).attr("id")),r.jmpressDelegatedClass&&a(k).removeClass(r.jmpressDelegatedClass),a(k).addClass(r.jmpressDelegatedClass="delegating-step-"+a(b).attr("id")),y.call(this,"applyTarget",s,a.extend({canvas:q,area:o},i)),s=b,t=h,z.call(this),h}function C(){function b(){function d(){(a(n).scrollTop()!==0||a(n).scrollLeft()!==0)&&b()}a(n)[0].tagName==="BODY"&&c.scrollTo(0,0),a(n).scrollTop(0),a(n).scrollLeft(0),setTimeout(d,1),setTimeout(d,10),setTimeout(d,100),setTimeout(d,200),setTimeout(d,400)}b()}function D(a){return B.call(this,a,"jump")}function E(){return B.call(this,y.call(this,"selectNext",s,{stepData:a(s).data("stepData")}),"next")}function F(){return B.call(this,y.call(this,"selectPrev",s,{stepData:a(s).data("stepData")}),"prev")}function G(){return B.call(this,y.call(this,"selectHome",s,{stepData:a(s).data("stepData")}),"home")}function H(){return B.call(this,y.call(this,"selectEnd",s,{stepData:a(s).data("stepData")}),"end")}function I(b){return l(q,b||{}),a(q)}function J(){return j}function K(){return t&&a(t)}function L(b,c,d){h[b]?y.call(this,b,c,d):a.error("callback "+b+" is not registered.")}function M(){var a=navigator.userAgent.toLowerCase(),b=a.search(/(iphone)|(ipod)|(android)/)===-1;return b}e=a.extend(!0,{},e||{});var f={},i=null;for(i in h)f[i]=a.isFunction(e[i])?[e[i]]:e[i],e[i]=[];var j=a.extend(!0,{},g,e);for(i in h)f[i]&&Array.prototype.push.apply(j[i],f[i]);var k=a(this),n=null,o=null,p={container:"",area:""},q=null,r=null,s=!1,t=!1;k.data("jmpressmethods",{select:B,scrollFix:C,goTo:D,next:E,prev:F,home:G,end:H,canvas:I,settings:J,active:K,fire:L,deinit:x,reapply:w});if(M()===!1){j.notSupportedClass&&k.addClass(j.notSupportedClass);return}j.notSupportedClass&&k.removeClass(j.notSupportedClass);var N=a(j.stepSelector,k);n=k,o=a("<div />"),q=a("<div />"),a(k).children().filter(N).each(function(){q.append(a(this))}),j.fullscreen&&(n=a("body"),o=k),p.area=o.attr("style")||"",p.container=n.attr("style")||"",j.fullscreen?(n.css({height:"100%"}),k.append(q)):(n.css({position:"relative"}),o.append(q),k.append(o)),a(n).addClass(j.containerClass),a(o).addClass(j.areaClass),a(q).addClass(j.canvasClass),b.documentElement.style.height="100%",n.css({overflow:"hidden"});var O={position:"absolute",transitionDuration:"0s"};O=a.extend({},j.animation,O),l(o,O),l(o,{top:"50%",left:"50%",perspective:"1000px"}),l(q,O),r={scalex:1},y.call(this,"beforeInit",null,{}),N.each(function(a){u.call(k,this,a)}),y.call(this,"afterInit",null,{}),B.call(this,y.call(this,"selectInitialStep","init",{})),j.initClass&&a(N).removeClass(j.initClass)}function j(){return g}function k(b,c){a.isFunction(c)?n[b]?a.error("function "+b+" is already registered."):n[b]=c:h[b]?a.error("callback "+b+" is already registered."):(h[b]=1,g[b]=[])}function l(b,c){var d,f,g={};for(d in c)c.hasOwnProperty(d)&&(f=e(d),f!==null&&(g[f]=c[d]));return a(b).css(g),b}function m(b){function c(a){a=a.split("-");for(var b=1;b<a.length;b++)a[b]=a[b].substr(0,1).toUpperCase()+a[b].substr(1);return a.join("")}if(a(b)[0].dataset)return a.extend({},a(b)[0].dataset);var d={},e=a(b)[0].attributes;return a.each(e,function(a,b){b.nodeName.substr(0,5)==="data-"&&(d[c(b.nodeName.substr(5))]=b.nodeValue)}),d}"use strict";var e=function(){var a=b.createElement("dummy").style,c="Webkit Moz O ms Khtml".split(" "),e={};return function(b){if(typeof e[b]=="undefined"){var f=b.charAt(0).toUpperCase()+b.substr(1),g=(b+" "+c.join(f+" ")+f).split(" ");e[b]=null;for(var h in g)if(a[g[h]]!==d){e[b]=g[h];break}}return e[b]}}(),g={stepSelector:".step",containerClass:"",canvasClass:"",areaClass:"",notSupportedClass:"not-supported",loadedClass:"loaded",fullscreen:!0,animation:{transformOrigin:"top left",transitionProperty:f(e("transform"))+", opacity",transitionDuration:"1s",transitionDelay:"500ms",transitionTimingFunction:"ease-in-out",transformStyle:"preserve-3d"},transitionDuration:1500,beforeChange:[],beforeInitStep:[],initStep:[],beforeInit:[],afterInit:[],beforeDeinit:[],afterDeinit:[],applyStep:[],unapplyStep:[],setInactive:[],beforeActive:[],setActive:[],selectInitialStep:[],selectPrev:[],selectNext:[],selectHome:[],selectEnd:[],loadStep:[],applyTarget:[],test:!1},h={beforeChange:1,beforeInitStep:1,initStep:1,beforeInit:1,afterInit:1,beforeDeinit:1,afterDeinit:1,applyStep:1,unapplyStep:1,setInactive:1,beforeActive:1,setActive:1,selectInitialStep:1,selectPrev:1,selectNext:1,selectHome:1,selectEnd:1,loadStep:1,applyTarget:1},n={init:i,deinit:function(){},css:l,pfx:e,defaults:j,register:k,dataset:m};a.fn.jmpress=function(b){function c(){var c=a(this).data("jmpressmethods");if(c&&c[b])if(b.substr(0,1)==="_"&&c.settings().test===!1)a.error("Method "+b+" is protected and should only be used internally.");else return c[b].apply(this,Array.prototype.slice.call(arguments,1));else if(n[b])if(b.substr(0,1)==="_"&&g.test===!1)a.error("Method "+b+" is protected and should only be used internally.");else return n[b].apply(this,Array.prototype.slice.call(arguments,1));else if(h[b]&&c){var d=c.settings(),e=Array.prototype.slice.call(arguments,1)[0];a.isFunction(e)&&(d[b]=d[b]||[],d[b].push(e))}else{if(typeof b=="object"||!b)return i.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.jmpress")}return this}var d=arguments,e;return a(this).each(function(a,b){e=c.apply(b,d)}),e},a.extend({jmpress:function(b){if(n[b])if(b.substr(0,1)==="_"&&g.test===!1)a.error("Method "+b+" is protected and should only be used internally.");else return n[b].apply(this,Array.prototype.slice.call(arguments,1));else if(h[b]){var c=Array.prototype.slice.call(arguments,1)[0];a.isFunction(c)?g[b].push(c):a.error("Second parameter should be a function: $.jmpress( callbackName, callbackFunction )")}else a.error("Method "+b+" does not exist on jQuery.jmpress")}})})(jQuery,document,window),function(a,b,c,d){function e(){return""+Math.round(Math.random()*1e5,0)}"use strict",function(){function b(b,c,d,e){var f;return b.each(function(b,g){if(e){f=c(g,d,e);if(f)return!1}if(a(g).is(d))return f=g,!1;if(!e){f=c(g,d,e);if(f)return!1}}),f}function c(d,e,f){var g=a(d).children();return f&&(g=a(g.get().reverse())),b(g,c,e,f)}function d(d,e,f){return b(a(d)[f?"prevAll":"nextAll"](),c,e,f)}function e(b,c,e){var f,g=a(b).parents();return g=a(g.get()),a.each(g.get(),function(b,g){if(e&&a(g).is(c))return f=g,!1;f=d(g,c,e);if(f)return!1}),f}a.fn.near=function(b,f){var g=[];return a(this).each(function(a,h){var i=(f?!1:c(h,b,f))||d(h,b,f)||e(h,b,f);i&&g.push(i)}),a(g)}}(),function(){var b={3:{_transform:function(b,d){var e="translate(-50%,-50%)";return d.revertRotate?(e+=c._rotate(d),e+=c._translate(d)):(e+=c._translate(d),e+=c._rotate(d)),e+=c._scale(d),a.jmpress("css",b,a.extend({},{transform:e},d.css)),!0},_translate:function(a){return a.x||a.y||a.z?" translate3d("+Math.round(a.x,4)+"px,"+Math.round(a.y,4)+"px,"+Math.round(a.z,4)+"px)":""},_rotate:function(a){var b=a.rotateX!==d?" rotateX("+Math.round(a.rotateX,4)+"deg)":"",c=a.rotateY!==d?" rotateY("+Math.round(a.rotateY,4)+"deg)":"",e=a.rotateZ!==d?" rotateZ("+Math.round(a.rotateZ,4)+"deg)":"";return a.revertRotate?e+c+b:b+c+e},_scale:function(a){return(a.scaleX&&a.scaleX!==1?" scaleX("+a.scaleX+")":"")+(a.scaleY&&a.scaleY!==1?" scaleY("+a.scaleY+")":"")+(a.scaleZ&&a.scaleZ!==1?" scaleZ("+a.scaleZ+")":"")}},2:{_transform:function(b,d){var e="translate(-50%,-50%)";return d.revertRotate?(e+=c._rotate(d),e+=c._translate(d)):(e+=c._translate(d),e+=c._rotate(d)),e+=c._scale(d),a.jmpress("css",b,a.extend({},{transform:e},d.css)),!0},_translate:function(a){return a.x||a.y?" translate("+Math.round(a.x,4)+"px,"+Math.round(a.y,4)+"px)":""},_rotate:function(a){return a.rotateZ!==d?" rotate("+a.rotateZ+"deg) ":""},_scale:function(a){return(a.scaleX&&a.scaleX!==1?" scaleX("+a.scaleX+")":"")+(a.scaleY&&a.scaleY!==1?" scaleY("+a.scaleY+")":"")}},1:{_transform:function(a,b){return(b.x||b.y)&&a.animate({top:b.y-a.height()/2+"px",left:b.x-a.width()/2+"px"},1e3),!0}}},c=function(){return a.jmpress("pfx","perspective")?b[3]:a.jmpress("pfx","transform")?b[2]:b[1]}();a.jmpress("initStep",function(b,c){var d=c.data,e=c.stepData;a.extend(e,{x:parseFloat(d.x)||0,y:parseFloat(d.y)||0,z:parseFloat(d.z)||0,r:parseFloat(d.r)||0,phi:parseFloat(d.phi)||0,rotate:parseFloat(d.rotate)||0,rotateX:parseFloat(d.rotateX)||0,rotateY:parseFloat(d.rotateY)||0,rotateZ:parseFloat(d.rotateZ)||0,revertRotate:!1,scale:parseFloat(d.scale)||1,scaleX:parseFloat(d.scaleX)||!1,scaleY:parseFloat(d.scaleY)||!1,scaleZ:parseFloat(d.scaleZ)||1})}),a.jmpress("applyStep",function(b,d){a.jmpress("css",a(b),{position:"absolute",transformStyle:"preserve-3d"}),d.parents.length>0&&a.jmpress("css",a(b),{top:"50%",left:"50%"});var e=a.extend({},d.stepData);e.rotateZ=e.rotateZ||e.rotate,e.scaleX=e.scaleX||e.scale,e.scaleY=e.scaleY||e.scale,e.x=e.x||e.r*Math.sin(e.phi*Math.PI/180),e.y=e.y||-e.r*Math.cos(e.phi*Math.PI/180),c._transform(a(b),e)}),a.jmpress("setActive",function(b,c){function g(a){c.current[a]===d&&(c.current[a]=e[a]);var b=c.current[a],f=e[a],g=b%360,h=f%360;g<0&&(g+=360),h<0&&(h+=360);var i=h-g;i<-180?i+=360:i>180&&(i-=360),c.current[a]=e[a]=b+i}var e=c.target,f=c.stepData;a.extend(e,{rotateX:-f.rotateX,rotateY:-f.rotateY,rotateZ:-(f.rotateZ||f.rotate),revertRotate:!0,scaleX:1/(f.scaleX||f.scale),scaleY:1/(f.scaleY||f.scale),scaleZ:1/f.scaleZ,x:-(f.x||f.r*Math.sin(f.phi*Math.PI/180)),y:-(f.y||-f.r*Math.cos(f.phi*Math.PI/180)),z:-f.z}),a.each(c.parents,function(b,c){var d=a(c).data("stepData"),f={x:1/(d.scaleX||d.scale),y:1/(d.scaleY||d.scale),z:1/d.scaleZ};e.x/=f.x,e.y/=f.y,e.z/=f.z;var g=-(d.rotateZ||d.rotate)/180*Math.PI,h=Math.sin(g),i=Math.cos(g),j=-d.rotateY/180*Math.PI,k=Math.sin(j),l=Math.cos(j),m=-d.rotateX/180*Math.PI,n=Math.sin(m),o=Math.cos(m),p,q,r;q=-e.x*h+e.y*i,p=e.x*i+e.y*h,r=e.z,e.x=p,e.y=q,e.z=r,q=e.y,p=e.x*l+e.z*k,r=e.x*k+e.z*l,e.x=p,e.y=q,e.z=r,q=e.y*o+e.z*n,p=e.x,r=-e.y*n+e.z*o,e.x=p,e.y=q,e.z=r,e.rotateX-=d.rotateX,e.rotateY-=d.rotateY,e.rotateZ-=d.rotateZ||d.rotate,e.x-=d.x||d.r*Math.sin(d.phi*Math.PI/180),e.y-=d.y||-d.r*Math.cos(d.phi*Math.PI/180),e.z-=d.z,e.scaleX*=f.x,e.scaleY*=f.y,e.scaleZ*=f.z}),g("rotateX"),g("rotateY"),g("rotateZ")}),a.jmpress("applyTarget",function(b,d){var e=d.target,f,g=d.stepData,h=d.settings,i=e.scaleX>=d.current.scalex;f={perspective:g.scaleX*1e3+"px"},f=a.extend({},h.animation,f),i||(f.transitionDelay="0"),b||(f.transitionDuration="0",f.transitionDelay="0"),a.jmpress("css",d.area,f),c._transform(d.area,{scaleX:e.scaleX,scaleY:e.scaleY,scaleZ:e.scaleZ}),f=a.extend({},h.animation),i&&(f.transitionDelay="0"),b||(f.transitionDuration="0",f.transitionDelay="0"),d.current.scalex=e.scaleX,e.scaleX=1,e.scaleY=1,e.scaleZ=1,c._transform(d.canvas,a.extend({},{css:f},e))})}(),function(){a.jmpress("defaults").nestedActiveClass="nested-active",a.jmpress("defaults").activeClass="active",a.jmpress("setInactive",function(b,c){c.settings.activeClass&&a(b).removeClass(c.settings.activeClass),c.settings.nestedActiveClass&&a.each(c.parents,function(b,d){a(d).removeClass(c.settings.nestedActiveClass)})}),a.jmpress("setActive",function(b,c){c.settings.activeClass&&a(b).addClass(c.settings.activeClass),c.settings.nestedActiveClass&&a.each(c.parents,function(b,d){a(d).addClass(c.settings.nestedActiveClass)})})}(),function(){function b(b,c){return a(this).find(c.settings.stepSelector).first()}a.jmpress("initStep",function(a,b){b.stepData.exclude=b.data.exclude&&["false","no"].indexOf(b.data.exclude)==-1}),a.jmpress("selectInitialStep",b),a.jmpress("selectHome",b),a.jmpress("selectEnd",function(b,c){return a(this).find(c.settings.stepSelector).last()}),a.jmpress("selectPrev",function(b,c){if(!b)return!1;do{var d=a(b).near(c.settings.stepSelector,!0);if(d.length===0||a(d).closest(this).length===0)d=a(this).find(c.settings.stepSelector).last();if(!d.length)return!1;b=d}while(b.data("stepData").exclude);return b}),a.jmpress("selectNext",function(b,c){if(!b)return!1;do{var d=a(b).near(c.settings.stepSelector);if(d.length===0||a(d).closest(this).length===0)d=a(this).find(c.settings.stepSelector).first();if(!d.length)return!1;b=d}while(b.data("stepData").exclude);return b})}(),function(){a.jmpress("selectInitialStep",function(a,b){return b.settings.start})}(),function(){function b(b,c){for(var d=0;d<b.length-1;d++){var e=b[d],f=b[d+1];a(e,this).attr("data-"+c,f)}}a.jmpress("register","route",function(a,c,d){b.call(this,a,d?"prev":"next"),c||b.call(this,a.reverse(),d?"next":"prev")}),a.jmpress("initStep",function(a,b){b.stepData.next=b.data.next,b.stepData.prev=b.data.prev}),a.jmpress("selectNext",function(b,c){if(c.stepData.next){var d=a(b).near(c.stepData.next);if(d&&d.length)return d;d=a(c.stepData.next,this).first();if(d&&d.length)return d}}),a.jmpress("selectPrev",function(b,c){if(c.stepData.prev){var d=a(b).near(c.stepData.prev,!0);if(d&&d.length)return d;d=a(c.stepData.prev,this).last();if(d&&d.length)return d}})}(),function(){a.jmpress("register","afterStepLoaded"),a.jmpress("initStep",function(b,c){c.stepData.src=a(b).attr("href")||c.data.src||!1}),a.jmpress("loadStep",function(b,c){var d=c.stepData.src;d&&a(b).load(d,function(d,e,f){a(c.jmpress).jmpress("fire","afterStepLoaded",b,a.extend({},c,{response:d,status:e,xhr:f}))})})}(),function(){a.jmpress("defaults").hash={use:!0,update:!0,bindChange:!0},a.jmpress("selectInitialStep",function(b,f){function g(){try{var b=a("#"+c.location.hash.replace(/^#\/?/,""));return b.length>0&&b.is(f.settings.stepSelector)?b:d}catch(e){}}f.current.hashNamespace=".jmpress-"+e();if(f.settings.hash.use&&f.settings.hash.bindChange){var h=this;a(c).bind("hashchange"+f.current.hashNamespace,function(){var b=g();a(h).jmpress("scrollFix");if(b){a(b).attr("id")!=a(h).jmpress("active").attr("id")&&a(h).jmpress("select",b);var d="#/"+a(b).attr("id");c.location.hash!=d&&(c.location.hash=d)}}),a("a[href^=#]").on("click"+f.current.hashNamespace,function(b){var c=a(this).attr("href");try{a(c).is(f.settings.stepSelector)&&(a(h).jmpress("select",c),b.preventDefault(),b.stopPropagation())}catch(d){}})}if(f.settings.hash.use)return g()}),a.jmpress("afterDeinit",function(b,d){a("a[href^=#]").off(d.current.hashNamespace),a(c).unbind(d.current.hashNamespace)}),a.jmpress("setActive",function(b,d){d.settings.hash.use&&d.settings.hash.update&&(clearTimeout(d.current.hashtimeout),d.current.hashtimeout=setTimeout(function(){c.location.hash="#/"+a(d.delegatedFrom).attr("id")},d.settings.transitionDuration+200))})}(),function(){a.jmpress("defaults").keyboard={use:!0,keys:{33:"prev",37:"prev",38:"prev",9:"next:prev",32:"next",34:"next",39:"next",40:"next",36:"home",35:"end"},ignore:{INPUT:[32,37,38,39,40],TEXTAREA:[32,37,38,39,40],SELECT:[38,40]},tabSelector:"a[href]:visible, :input:visible"},a.jmpress("afterInit",function(c,f){var g=f.settings.keyboard,h=this;f.settings.fullscreen||a(this).attr("tabindex",0),f.current.keyboardNamespace=".jmpress-"+e(),a(f.settings.fullscreen?b:this).bind("keypress"+f.current.keyboardNamespace,function(a){for(var b in g.ignore)if(a.target.nodeName==b&&g.ignore[b].indexOf(a.which)!=-1)return;a.keyCode>=37&&a.keyCode<=40&&(a.preventDefault(),a.stopPropagation())}),a(f.settings.fullscreen?b:this).bind("keydown"+f.current.keyboardNamespace,function(b){if(!f.settings.fullscreen&&!a(b.target).closest(h).length||!g.use)return;for(var c in g.ignore)if(b.target.nodeName==c&&g.ignore[c].indexOf(b.which)!=-1)return;var e=!1,i;if(b.which==9){a(b.target).closest(a(h).jmpress("active")).length?(i=a(b.target).near(g.tabSelector,b.shiftKey),a(i).closest(f.settings.stepSelector).is(a(h).jmpress("active"))||(i=d)):b.shiftKey?e=!0:i=a(h).jmpress("active").find("a[href], :input").filter(":visible").first();if(i&&i.length>0){i.focus(),a(h).jmpress("scrollFix"),b.preventDefault(),b.stopPropagation();return}b.shiftKey&&(e=!0)}var j=g.keys[b.which];typeof j=="string"?(j.indexOf(":")!==-1&&(j=j.split(":"),j=b.shiftKey?j[1]:j[0]),a(h).jmpress(j),b.preventDefault(),b.stopPropagation()):j&&(a(h).jmpress.apply(a(this),j),b.preventDefault(),b.stopPropagation()),e&&(i=a(h).jmpress("active").find("a[href], :input").filter(":visible").last(),i.focus(),a(h).jmpress("scrollFix"))})}),a.jmpress("afterDeinit",function(c,d){a(b).unbind(d.current.keyboardNamespace)})}(),function(){a.jmpress("defaults").viewPort={width:!1,height:!1,maxScale:0,minScale:0},a.jmpress("afterInit",function(b,d){var f=this;d.current.viewPortNamespace=".jmpress-"+e(),a(c).bind("resize"+d.current.viewPortNamespace,function(b){a(f).jmpress("select",a(f).jmpress("active"),"resize")})}),a.jmpress("afterDeinit",function(b,d){a(c).unbind("resize"+d.current.viewPortNamespace)}),a.jmpress("setActive",function(b,c){var d=c.settings.viewPort,e=d.height&&a(c.container).innerHeight()/d.height,f=d.width&&a(c.container).innerWidth()/d.width,g=(f||e)&&Math.min(f||e,e||f);g&&(d.maxScale&&(g=Math.min(g,d.maxScale)),d.minScale&&(g=Math.max(g,d.minScale)),c.target.scaleX*=g,c.target.scaleY*=g,c.target.scaleZ*=g)})}(),function(){a.jmpress("defaults").mouse={clickSelects:!0},a.jmpress("afterInit",function(b,c){c.current.clickableStepsNamespace=".jmpress-"+e();var d=this;a(this).bind("click"+c.current.clickableStepsNamespace,function(b){if(!c.settings.mouse.clickSelects)return;if(a(b.target).closest(c.settings.stepSelector).is(a(d).jmpress("active")))return;var e=a(b.target).closest(c.settings.stepSelector);e.length&&(a(this).jmpress("select",e[0],"click"),b.preventDefault(),b.stopPropagation())})}),a.jmpress("afterDeinit",function(b,c){a(this).unbind(c.current.clickableStepsNamespace)})}(),function(){function c(b,e,f){for(var g in e){var h=g;f&&(h=f+h.substr(0,1).toUpperCase()+h.substr(1)),a.isPlainObject(e[g])?c(b,e[g],h):b[h]===d&&(b[h]=e[g])}}function e(b,d){a.isArray(d)?d.length<b.length?a.error("more nested steps than children in template"):b.each(function(b,e){var f=a(e).data("_template_")||{};c(f,d[b]),a(e).data("_template_",f)}):a.isFunction(d)&&b.each(function(b,e){var f=a(e).data("_template_")||{};c(f,d(b,e)),a(e).data("_template_",f)})}var b={};a.jmpress("beforeInitStep",function(d,f){function g(b,c,d){if(d.children){var g=a(c).children(f.settings.stepSelector);e(g,d.children)}h(b,d)}function h(a,b){c(a,b)}var i=f.data.template;i&&a.each(i.split(" "),function(a,c){var e=b[c];g(f.data,d,e)});var j=a(d).data("_applied_template_");j&&g(f.data,d,j);var k=a(d).data("_template_");k&&(g(f.data,d,k),d.data("_template_",null),k.template&&a.each(k.template.split(" "),function(a,c){var e=b[c];g(f.data,d,e)}))}),a.jmpress("beforeInit",function(c,d){var f=a.jmpress("dataset",this);if(f.template){var g=b[f.template];e(a(this).find(d.settings.stepSelector).filter(function(){return!a(this).parent().is(d.settings.stepSelector)}),g.children)}}),a.jmpress("register","template",function(c,d){b[c]?b[c]=a.extend(!0,{},b[c],d):b[c]=a.extend(!0,{},d)}),a.jmpress("register","apply",function(d,f){if(!f){var g=a(this).jmpress("settings").stepSelector;e(a(this).find(g).filter(function(){return!a(this).parent().is(g)}),d)}else if(a.isArray(f))e(a(d),f);else{var h;typeof f=="string"?h=b[f]:h=a.extend(!0,{},f),a(d).each(function(b,d){var e=a(d).data("_applied_template_")||{};c(e,h),a(d).data("_applied_template_",e)})}})}()}(jQuery,document,window)